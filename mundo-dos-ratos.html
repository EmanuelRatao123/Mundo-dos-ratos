<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mundo Dos Ratos</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Press Start 2P', cursive;
            background: #000;
            color: #fff;
            overflow: hidden;
        }
        
        #game {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .screen {
            display: none;
            width: 800px;
            max-width: 90%;
            text-align: center;
        }
        
        .screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }
        
        h1 {
            font-size: 48px;
            color: #ff0;
            text-shadow: 4px 4px #f00;
            margin-bottom: 20px;
        }
        
        button {
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            padding: 15px 30px;
            background: #fff;
            color: #000;
            border: 4px solid #000;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 4px 4px #888;
        }
        
        button:hover {
            background: #ff0;
            transform: translate(2px, 2px);
            box-shadow: 2px 2px #888;
        }
        
        .typewriter {
            font-size: 20px;
            line-height: 1.8;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        #battleCanvas {
            border: 4px solid #fff;
            background: #000;
        }
        
        .battle-ui {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }
        
        .hp-bar {
            font-size: 18px;
            text-align: left;
        }
        
        input {
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            padding: 15px;
            background: #000;
            color: #fff;
            border: 4px solid #fff;
            text-align: center;
        }
        
        .class-select {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .press-enter {
            font-size: 14px;
            color: #888;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="game">
        <!-- Tela Inicial -->
        <div id="mainMenu" class="screen active">
            <h1>MUNDO DOS RATOS</h1>
            <button onclick="startGame()">PLAY</button>
            <button onclick="saveProgress()">SALVAR PROGRESSO</button>
            <button onclick="loadProgress()">CARREGAR PROGRESSO</button>
            <button onclick="showAchievements()">CONQUISTAS</button>
            <button onclick="showCredits()">CR√âDITOS</button>
            <button onclick="showAdminLogin()">ADMIN</button>
        </div>
        
        <!-- Cr√©ditos -->
        <div id="creditsScreen" class="screen">
            <h1>CR√âDITOS</h1>
            <div style="margin: 40px 0; font-size: 18px; line-height: 2;">
                <p>Emanuel</p>
                <p>Rat√£o</p>
            </div>
            <p style="font-size: 14px; color: #ff0; margin: 20px 0;">Feito com muito carinho!</p>
            <button onclick="backToMenu()">VOLTAR</button>
        </div>
        
        <!-- Conquistas -->
        <div id="achievementsScreen" class="screen">
            <h1>CONQUISTAS</h1>
            <div id="achievementsList" style="margin: 40px 0; font-size: 14px; line-height: 2; max-height: 400px; overflow-y: auto;">
                <p>Nenhuma conquista desbloqueada ainda!</p>
            </div>
            <button onclick="backToMenu()">VOLTAR</button>
        </div>
        
        <!-- Login Admin -->
        <div id="adminLoginScreen" class="screen">
            <h1>PAINEL ADMIN</h1>
            <div style="margin: 40px 0;">
                <p style="margin-bottom: 15px; font-size: 14px;">Digite a senha:</p>
                <input type="password" id="adminPassword" placeholder="SENHA">
            </div>
            <button onclick="checkAdminPassword()">ENTRAR</button>
            <button onclick="backToMenu()">VOLTAR</button>
        </div>
        
        <!-- Painel Admin -->
        <div id="adminPanel" class="screen">
            <h1>PAINEL ADMIN</h1>
            <div style="margin: 40px 0; font-size: 14px; line-height: 2; text-align: left; max-width: 600px;">
                <p>Nome: <span id="adminPlayerName">-</span></p>
                <p>Classe: <span id="adminPlayerClass">-</span></p>
                <p>Level: <input type="number" id="adminLevel" style="width: 100px;"></p>
                <p>For√ßa: <input type="number" id="adminStrength" style="width: 100px;"></p>
                <p>Posi√ß√£o X: <span id="adminPlayerX">-</span></p>
                <p>Posi√ß√£o Y: <span id="adminPlayerY">-</span></p>
                <p style="margin-top: 20px;">Poderes:</p>
                <input type="text" id="adminPower" placeholder="Nome do poder" style="width: 300px; margin-top: 10px;">
                <button onclick="addPower()" style="margin-top: 10px; padding: 10px;">ADICIONAR PODER</button>
                <div id="powersList" style="margin-top: 10px; color: #0ff;"></div>
            </div>
            <button onclick="saveAdminChanges()">SALVAR ALTERA√á√ïES</button>
            <button onclick="clearAllData()">LIMPAR DADOS</button>
            <button onclick="backToMenu()">VOLTAR</button>
        </div>
        
        <!-- Quiz -->
        <div id="quizScreen" class="screen">
            <h1>QUIZ</h1>
            <div class="typewriter" id="quizQuestion">Qual o maior rato do mundo?</div>
            <button onclick="chooseMCRatao()">MC RAT√ÉO</button>
            <button onclick="chooseEmanuel()">EMANUEL</button>
        </div>
        
        <!-- Tela de Batalha -->
        <div id="battleScreen" class="screen">
            <div class="typewriter" id="battleText"></div>
            <canvas id="battleCanvas" width="600" height="400"></canvas>
            <div class="battle-ui">
                <div class="hp-bar">
                    <div>RAT√ÉO HP: <span id="enemyHP">999999</span></div>
                    <div>SEU HP: <span id="playerHP">100</span></div>
                    <div>SUA FOR√áA: <span id="playerStrength">1</span></div>
                </div>
                <button id="attackBtn" onclick="attack()" style="display:none;">ATACAR</button>
            </div>
        </div>
        
        <!-- Game Over -->
        <div id="gameOverScreen" class="screen">
            <h1>GAME OVER</h1>
            <div class="typewriter">Voc√™ foi derrotado...</div>
            <button onclick="backToMenu()">VOLTAR AO MENU</button>
        </div>
        
        <!-- Cria√ß√£o de Personagem -->
        <div id="characterScreen" class="screen">
            <h1>CRIE SEU PERSONAGEM</h1>
            <div style="margin: 20px 0;">
                <p style="margin-bottom: 15px;">Digite seu nome:</p>
                <input type="text" id="playerName" maxlength="15" placeholder="SEU NOME">
            </div>
            <div style="margin: 20px 0;">
                <p style="margin-bottom: 15px;">Escolha sua classe:</p>
                <div class="class-select">
                    <button onclick="selectClass('GUERREIRO')">GUERREIRO</button>
                    <button onclick="selectClass('MAGO')">MAGO</button>
                    <button onclick="selectClass('ARQUEIRO')">ARQUEIRO</button>
                </div>
            </div>
        </div>
        
        <!-- Lore -->
        <div id="loreScreen" class="screen">
            <div class="typewriter" id="loreText"></div>
            <div class="press-enter" id="pressEnter" style="display:none;">Pressione ENTER</div>
        </div>
        
        <!-- Di√°logo -->
        <div id="dialogScreen" class="screen">
            <div class="typewriter" id="dialogText" style="min-height: 150px;"></div>
            <div id="dialogOptions" style="display: flex; flex-direction: column; gap: 15px;"></div>
        </div>
        
        <!-- Mundo 2D -->
        <div id="worldScreen" class="screen">
            <canvas id="worldCanvas" width="800" height="600"></canvas>
            <div style="margin-top: 20px; display: flex; gap: 20px; align-items: center; justify-content: center;">
                <p style="font-size: 12px;">Use as SETAS para mover</p>
                <button onclick="saveProgress()">SALVAR</button>
                <button onclick="backToMenu()">MENU</button>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            playerName: '',
            playerClass: '',
            level: 1,
            currentScreen: 'mainMenu',
            strength: 1,
            powers: [],
            achievements: []
        };
        
        let battleState = {
            playerHP: 100,
            enemyHP: 999999,
            playerX: 300,
            playerY: 200,
            attacked: false
        };
        
        let loreStep = 0;
        const loreTexts = [
            "A muitos anos atr√°s Ratos dominaram o mundo...",
            "Voc√™ √© um simples humano... Mais um humano que vai mudar o mundo.",
            "Ent√£o v√°, inicie sua jornada"
        ];
        
        let dialogState = {
            step: 0,
            answered1: false,
            answered2: false
        };
        
        let worldState = {
            playerX: 400,
            playerY: 300,
            keys: {},
            sprites: {},
            currentSprite: 'idle',
            animationFrame: 0,
            animationTimer: 0,
            animationSpeed: 200 // 5 fps = 200ms por frame
        };
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            gameState.currentScreen = screenId;
        }
        
        function startGame() {
            showScreen('quizScreen');
        }
        
        function saveProgress() {
            gameState.worldState = {
                playerX: worldState.playerX,
                playerY: worldState.playerY
            };
            localStorage.setItem('mundoDosRatos', JSON.stringify(gameState));
            alert('Progresso salvo!');
        }
        
        function loadProgress() {
            const saved = localStorage.getItem('mundoDosRatos');
            if (saved) {
                gameState = JSON.parse(saved);
                if (gameState.worldState) {
                    worldState.playerX = gameState.worldState.playerX;
                    worldState.playerY = gameState.worldState.playerY;
                }
                alert('Progresso carregado!');
                if (gameState.playerName && gameState.playerClass) {
                    showScreen('worldScreen');
                    initWorld();
                }
            } else {
                alert('Nenhum progresso salvo encontrado!');
            }
        }
        
        function chooseMCRatao() {
            showScreen('battleScreen');
            document.getElementById('playerStrength').textContent = gameState.strength;
            typewriterEffect('battleText', 'Voc√™ irritou o Rat√£o', () => {
                setTimeout(() => {
                    document.getElementById('attackBtn').style.display = 'block';
                    startBattle();
                }, 1000);
            });
        }
        
        function chooseEmanuel() {
            showScreen('characterScreen');
        }
        
        function selectClass(className) {
            const name = document.getElementById('playerName').value;
            if (!name) {
                alert('Digite seu nome primeiro!');
                return;
            }
            gameState.playerName = name;
            gameState.playerClass = className;
            showScreen('loreScreen');
            loreStep = 0;
            showLore();
        }
        
        function showLore() {
            const loreText = document.getElementById('loreText');
            const pressEnter = document.getElementById('pressEnter');
            
            loreText.textContent = '';
            pressEnter.style.display = 'none';
            
            typewriterEffect('loreText', loreTexts[loreStep], () => {
                if (loreStep < loreTexts.length - 1) {
                    pressEnter.style.display = 'block';
                } else {
                    setTimeout(() => startDialog(), 1000);
                }
            });
        }
        
        function showCredits() {
            showScreen('creditsScreen');
        }
        
        function showAchievements() {
            showScreen('achievementsScreen');
            const list = document.getElementById('achievementsList');
            if (gameState.achievements.length === 0) {
                list.innerHTML = '<p>Nenhuma conquista desbloqueada ainda!</p>';
            } else {
                list.innerHTML = gameState.achievements.map(a => `<p>üèÜ ${a}</p>`).join('');
            }
        }
        
        function unlockAchievement(name) {
            if (!gameState.achievements.includes(name)) {
                gameState.achievements.push(name);
                alert('üèÜ CONQUISTA DESBLOQUEADA: ' + name);
                saveProgress();
            }
        }
        
        function showAdminLogin() {
            showScreen('adminLoginScreen');
            document.getElementById('adminPassword').value = '';
        }
        
        function checkAdminPassword() {
            const input = document.getElementById('adminPassword').value;
            const hash = btoa(input);
            const correctHash = 'UmF0bzEyMw==';
            
            if (hash === correctHash) {
                showAdminPanel();
            } else {
                alert('Senha incorreta!');
            }
        }
        
        function showAdminPanel() {
            showScreen('adminPanel');
            document.getElementById('adminPlayerName').textContent = gameState.playerName || '-';
            document.getElementById('adminPlayerClass').textContent = gameState.playerClass || '-';
            document.getElementById('adminLevel').value = gameState.level || 1;
            document.getElementById('adminStrength').value = gameState.strength || 1;
            document.getElementById('adminPlayerX').textContent = worldState.playerX || '-';
            document.getElementById('adminPlayerY').textContent = worldState.playerY || '-';
            updatePowersList();
        }
        
        function updatePowersList() {
            const list = document.getElementById('powersList');
            if (gameState.powers.length === 0) {
                list.innerHTML = '<p>Nenhum poder adicionado</p>';
            } else {
                list.innerHTML = gameState.powers.map((p, i) => 
                    `<p>‚ö° ${p} <button onclick="removePower(${i})" style="padding: 5px; font-size: 10px;">X</button></p>`
                ).join('');
            }
        }
        
        function addPower() {
            const powerInput = document.getElementById('adminPower');
            const power = powerInput.value.trim();
            if (power) {
                gameState.powers.push(power);
                powerInput.value = '';
                updatePowersList();
            }
        }
        
        function removePower(index) {
            gameState.powers.splice(index, 1);
            updatePowersList();
        }
        
        function saveAdminChanges() {
            gameState.level = parseInt(document.getElementById('adminLevel').value) || 1;
            gameState.strength = parseInt(document.getElementById('adminStrength').value) || 1;
            saveProgress();
            alert('Altera√ß√µes salvas!');
        }
        
        function clearAllData() {
            if (confirm('Tem certeza que deseja limpar todos os dados?')) {
                localStorage.removeItem('mundoDosRatos');
                gameState = {
                    playerName: '',
                    playerClass: '',
                    level: 1,
                    currentScreen: 'mainMenu'
                };
                alert('Dados limpos!');
                backToMenu();
            }
        }
        
        function startDialog() {
            showScreen('dialogScreen');
            dialogState = { step: 0, answered1: false, answered2: false };
            showDialog();
        }
        
        function showDialog() {
            const dialogText = document.getElementById('dialogText');
            const dialogOptions = document.getElementById('dialogOptions');
            
            dialogText.textContent = '';
            dialogOptions.innerHTML = '';
            
            if (dialogState.step === 0) {
                typewriterEffect('dialogText', 'Voc√™ encarou um rato!', () => {
                    setTimeout(() => {
                        dialogState.step = 1;
                        showDialog();
                    }, 1500);
                });
            } else if (dialogState.step === 1) {
                typewriterEffect('dialogText', 'Ol√° humano, todos os ratos aqui foram contaminados, menos eu!', () => {
                    dialogOptions.innerHTML = `
                        <button onclick="answerDialog(1)">Quem √© voc√™?</button>
                        <button onclick="answerDialog(2)">Ok, mais onde eu estou?</button>
                    `;
                });
            } else if (dialogState.step === 2) {
                dialogOptions.innerHTML = '';
                typewriterEffect('dialogText', 'Eu sou o Rat√£o! Serei seu companheiro nesta aventura enorme', () => {
                    dialogState.answered1 = true;
                    if (dialogState.answered2) {
                        dialogOptions.innerHTML = '<button onclick="startWorld()">Ok, vamos</button>';
                    } else {
                        dialogOptions.innerHTML = '<button onclick="answerDialog(2)">Ok, mais onde eu estou?</button>';
                    }
                });
            } else if (dialogState.step === 3) {
                dialogOptions.innerHTML = '';
                typewriterEffect('dialogText', 'Voc√™ est√° no Mundo Dos Ratos, na guerra dos humanos e dos ratos os ratos ganharam, todos eles foram corrompidos pela ganancia, menos eu! Nem eu sei como voc√™ chegou aqui, mais voc√™ est√° aqui, e eu serei seu parceiro.', () => {
                    dialogState.answered2 = true;
                    if (dialogState.answered1) {
                        dialogOptions.innerHTML = '<button onclick="startWorld()">Ok, vamos</button>';
                    } else {
                        dialogOptions.innerHTML = '<button onclick="answerDialog(1)">Quem √© voc√™?</button>';
                    }
                });
            }
        }
        
        function answerDialog(choice) {
            if (choice === 1 && !dialogState.answered1) {
                dialogState.step = 2;
                showDialog();
            } else if (choice === 2 && !dialogState.answered2) {
                dialogState.step = 3;
                showDialog();
            }
        }
        
        function startWorld() {
            showScreen('worldScreen');
            initWorld();
        }
        
        function initWorld() {
            const canvas = document.getElementById('worldCanvas');
            const ctx = canvas.getContext('2d');
            
            // Carregar sprites
            worldState.sprites = {
                idle: new Image(),
                walk1: new Image(),
                walk2: new Image()
            };
            
            worldState.sprites.idle.src = 'Sprites/Parado/Parado.png';
            worldState.sprites.walk1.src = 'Sprites/Andando/Andando1.png';
            worldState.sprites.walk2.src = 'Sprites/Andando/Andando2.png';
            
            document.addEventListener('keydown', (e) => {
                worldState.keys[e.key] = true;
            });
            
            document.addEventListener('keyup', (e) => {
                worldState.keys[e.key] = false;
            });
            
            let lastTime = Date.now();
            
            function updateWorld() {
                const speed = 5;
                let isMoving = false;
                
                if (worldState.keys['ArrowLeft'] && worldState.playerX > 20) {
                    worldState.playerX -= speed;
                    isMoving = true;
                }
                if (worldState.keys['ArrowRight'] && worldState.playerX < 780) {
                    worldState.playerX += speed;
                    isMoving = true;
                }
                if (worldState.keys['ArrowUp'] && worldState.playerY > 20) {
                    worldState.playerY -= speed;
                    isMoving = true;
                }
                if (worldState.keys['ArrowDown'] && worldState.playerY < 580) {
                    worldState.playerY += speed;
                    isMoving = true;
                }
                
                // Atualizar anima√ß√£o
                const currentTime = Date.now();
                const deltaTime = currentTime - lastTime;
                
                if (isMoving) {
                    worldState.animationTimer += deltaTime;
                    if (worldState.animationTimer >= worldState.animationSpeed) {
                        worldState.animationTimer = 0;
                        worldState.animationFrame = worldState.animationFrame === 0 ? 1 : 0;
                    }
                    worldState.currentSprite = worldState.animationFrame === 0 ? 'walk1' : 'walk2';
                } else {
                    worldState.currentSprite = 'idle';
                    worldState.animationFrame = 0;
                    worldState.animationTimer = 0;
                }
                
                lastTime = currentTime;
            }
            
            function drawWorld() {
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Grid
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                for (let i = 0; i < canvas.width; i += 50) {
                    ctx.beginPath();
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, canvas.height);
                    ctx.stroke();
                }
                for (let i = 0; i < canvas.height; i += 50) {
                    ctx.beginPath();
                    ctx.moveTo(0, i);
                    ctx.lineTo(canvas.width, i);
                    ctx.stroke();
                }
                
                // Player sprite
                const sprite = worldState.sprites[worldState.currentSprite];
                if (sprite.complete) {
                    ctx.drawImage(sprite, worldState.playerX - 75, worldState.playerY - 50, 150, 100);
                }
                
                // Rat√£o companion
                ctx.fillStyle = '#ff0';
                ctx.font = '32px "Press Start 2P"';
                ctx.textAlign = 'center';
                ctx.fillText('üêÄ', worldState.playerX + 50, worldState.playerY);
                
                // Info
                ctx.fillStyle = '#fff';
                ctx.font = '12px "Press Start 2P"';
                ctx.textAlign = 'left';
                ctx.fillText('EM DESENVOLVIMENTO', 10, 30);
            }
            
            function gameLoop() {
                updateWorld();
                drawWorld();
                requestAnimationFrame(gameLoop);
            }
            
            gameLoop();
        }
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && gameState.currentScreen === 'loreScreen') {
                loreStep++;
                if (loreStep < loreTexts.length) {
                    showLore();
                }
            }
        });
        
        function typewriterEffect(elementId, text, callback) {
            const element = document.getElementById(elementId);
            element.textContent = '';
            let i = 0;
            
            const interval = setInterval(() => {
                if (i < text.length) {
                    element.textContent += text[i];
                    i++;
                } else {
                    clearInterval(interval);
                    if (callback) callback();
                }
            }, 50);
        }
        
        function startBattle() {
            const canvas = document.getElementById('battleCanvas');
            const ctx = canvas.getContext('2d');
            
            function drawPlayer() {
                ctx.fillStyle = '#00f';
                ctx.beginPath();
                ctx.arc(battleState.playerX, battleState.playerY, 15, 0, Math.PI * 2);
                ctx.fill();
            }
            
            function drawEnemy() {
                ctx.fillStyle = '#f00';
                ctx.font = '48px "Press Start 2P"';
                ctx.textAlign = 'center';
                ctx.fillText('üêÄ', 300, 100);
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawEnemy();
                drawPlayer();
                
                if (battleState.playerHP > 0) {
                    requestAnimationFrame(animate);
                }
            }
            
            animate();
            
            document.addEventListener('keydown', movePlayer);
        }
        
        function movePlayer(e) {
            const speed = 10;
            if (e.key === 'ArrowLeft' && battleState.playerX > 15) battleState.playerX -= speed;
            if (e.key === 'ArrowRight' && battleState.playerX < 585) battleState.playerX += speed;
            if (e.key === 'ArrowUp' && battleState.playerY > 15) battleState.playerY -= speed;
            if (e.key === 'ArrowDown' && battleState.playerY < 385) battleState.playerY += speed;
        }
        
        function attack() {
            if (battleState.attacked) return;
            
            battleState.attacked = true;
            const damage = gameState.strength;
            battleState.enemyHP -= damage;
            document.getElementById('enemyHP').textContent = battleState.enemyHP;
            
            if (battleState.enemyHP <= 0) {
                document.getElementById('battleText').textContent = '';
                typewriterEffect('battleText', 'Voc√™ derrotou o Rat√£o!', () => {
                    unlockAchievement('Derrotou o Rat√£o Imposs√≠vel!');
                    setTimeout(() => {
                        backToMenu();
                    }, 2000);
                });
            } else {
                document.getElementById('battleText').textContent = '';
                typewriterEffect('battleText', 'Fraco...', () => {
                    setTimeout(() => {
                        battleState.playerHP = 0;
                        document.getElementById('playerHP').textContent = 0;
                        setTimeout(() => {
                            showScreen('gameOverScreen');
                        }, 1000);
                    }, 1500);
                });
            }
        }
        
        function backToMenu() {
            battleState = {
                playerHP: 100,
                enemyHP: 999999,
                playerX: 300,
                playerY: 200,
                attacked: false
            };
            document.getElementById('enemyHP').textContent = 999999;
            document.getElementById('playerHP').textContent = 100;
            document.getElementById('attackBtn').style.display = 'none';
            showScreen('mainMenu');
        }
    </script>
</body>
</html>
